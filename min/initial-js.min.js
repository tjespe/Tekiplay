var app=angular.module("app",["ngRoute"]);
app.config(["$routeProvider","$sceProvider","$locationProvider","$controllerProvider","$provide","$compileProvider","$filterProvider","$sceDelegateProvider",function(l,h,d,m,f,k,a,p){p.resourceUrlWhitelist(["self","https://script.google.com"]);l.when("/",{templateUrl:"src/views/home.html"}).when("/tag/:category",{templateUrl:"src/views/category.html",controller:"categoryCtrl",controllerAs:"cat"}).when("/search/:category",{templateUrl:"src/views/category.html",controller:"categoryCtrl",controllerAs:"cat"}).when("/id/:id",
{controller:"gameCtrl",controllerAs:"g",templateUrl:"src/views/game.html"}).when("/submit",{templateUrl:"src/views/submit.html"}).when("/cookies",{templateUrl:"src/views/policy.html"}).when("/contact",{templateUrl:"src/views/contact.html"}).when("/game/:id",{redirectTo:"/id/:id"}).when("/tag",{redirectTo:"/"}).when("/403",{templateUrl:"src/views/error.html"}).when("/401",{templateUrl:"src/views/error.html"}).otherwise({templateUrl:"src/views/error.html"});h.enabled(!0);d.html5Mode(!0);app.controller=
function(a,e){m.register(a,e);return this};app.service=function(a,e){f.service(a,e);return this};app.factory=function(a,e){f.factory(a,e);return this};app.value=function(a,e){f.value(a,e);return this};app.directive=function(a,e){k.directive(a,e);return this};app.filter=function(g,e){a.register(g,e);return this}}]);
app.service("initialJSON",["$http","$lhttp","urls",function(l,h,d){this.pass=encodeURIComponent(window.location.search.slice(1)+window.location.hash.slice(1));this.json=h.get(this.pass.length?"https://script.google.com/macros/s/AKfycbzEVUBnYRqGOFS6309I9Oe748omXUWLjpDScrjYatNvxKuL6BEU/exec?pass="+this.pass:d.initialJSON);this.jquery=h.get("https://code.jquery.com/jquery-2.2.3.min.js",0);this.jquery.then(function(d){eval(d)})}]);
app.directive("script",function(){return{restrict:"E",scope:!1,link:function(l,h,d){"text/javascript-lazy"===d.type&&eval(h[0].text)}}});
app.value("urls",{rating:"https://script.google.com/macros/s/AKfycbzulzGAeSR2eErndxSAUkDi3dXlnmYif0MlkpjnfJsHKVNSMpE/exec",checkIfChanged:"https://script.google.com/macros/s/AKfycbwx-oLuzjUIAPxMxKiiNFgt6Wgb6T4WGO8UguTGu8HCXUBt-SX7/exec",comment:"https://script.google.com/macros/s/AKfycbwK2mif23UU5f9B2NXuvcRT6VajMU7iXQPxRnlKeNtfsD2Eflvz/exec",countGames:"https://script.google.com/macros/s/AKfycbwc3i7zLH3vC8HWnVtBVPqZkv8iOMIlxKZ1E7gL2bdIL8kd9lA/exec",getGames:"https://script.google.com/macros/s/AKfycbxGh5agyHkqBi5KbpYxl9G2gJlR5kuJzjJ--5BaP-KfcgaItx0/exec",
submitGame:"https://script.google.com/macros/s/AKfycbxh_WPU_DKwT3xAxR0BCcjb_wQ4pQG2nspBbpKra94BEYlO4yw/exec",subscribe:"",initialJSON:"/min/initialJSON.json"});
app.service("$lhttp",["$http","$q","$timeout",function(l,h,d){var m=this;m.ldbOn=!0;try{!function(){function d(g,e){return a?void(a.transaction("s").objectStore("s").get(g).onsuccess=function(a){e(a.target.result&&a.target.result.v||null)}):void setTimeout(function(){d(g,e)},100)}var k=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;if(!k)return void console.error("indexDB not supported");var a,h={k:"",v:""};k=k.open("d2",1);k.onsuccess=function(g){a=this.result};
k.onerror=function(a){console.error("indexedDB request error");console.log(a)};k.onupgradeneeded=function(d){a=null;d.target.result.createObjectStore("s",{keyPath:"k"}).transaction.oncomplete=function(e){a=e.target.db}};window.ldb={get:d,set:function(d,e){h.k=d;h.v=e;a.transaction("s","readwrite").objectStore("s").put(h)}}}()}catch(f){console.warn("Unable to use lbd, using localStorage instead. Error:",f),m.ldbOn=!1}m.get=function(f,k,a,p){var g=h.defer();"undefined"===typeof a&&(a={});a.timeout=
g.promise;a=l.get(f,a);a.success(function(a){try{m.ldbOn?ldb.set(f,JSON.stringify(a)):localStorage[f]=JSON.stringify(a)}catch(q){console.log("Couldn't save "+f+"-data to storage. Error:",q)}g.resolve(a)});a.error(function(a,d){try{ldb.get(f,function(a){null!==a?g.resolve(JSON.parse(a)):"undefined"!==typeof localStorage[f]?g.resolve(JSON.parse(localStorage[f])):g.reject("ERROR")})}catch(u){try{"undefined"!==typeof localStorage[f]?g.resolve(JSON.parse(localStorage[f])):g.reject("ERROR")}catch(b){g.reject("ERROR")}}});
"undefined"!==typeof k&&d(function(){m.ldbOn?ldb.get(f,function(a){null!==a?g.resolve(JSON.parse(a)):""}):"undefined"!==typeof Storage&&f in localStorage&&g.resolve(JSON.parse(localStorage[f]))},k);"undefined"!==typeof p&&p["catch"](function(){g.reject("Canceled")});return g.promise}}]);app.controller("masterCtrl",["$http","$window","$rootScope","$routeParams","$scope","$location","$timeout","$injector","$q","initialJSON","$lhttp","urls",function(l,h,d,m,f,k,a,p,g,e,q,u){var b=this,t=18,c=!1;b.disabled=!1;b.lang=window.navigator.language.replace(/-.+/g,"");b.desc="";b.games=[];b.categories={};b.routeChanged=!1;b.verifiedUser=!1;b.query="";b.tags=[{name:"Puzzle",amount:470},{name:"Action",amount:334},{name:"Jigsaw Puzzles",amount:315},{name:"Shooting",amount:256},{name:"HTML5",
amount:210},{name:"Racing",amount:202},{name:"Adventure",amount:196}];b.textData={};b.tagLimit=8;b.showAllTags=!1;b.availableLangs=["en","es","no"];window.location.href.includes("lang=")&&(b.lang=window.location.href.replace(/.+lang=/,""));b.lang="nb"==b.lang||"nn"==b.lang?"no":b.lang;b.lang=-1<b.availableLangs.indexOf(b.lang)?b.lang:"en";b.allGamesAreDisplayed=function(){return b.games.length<t?!1:!0};e.json.then(function(a){Array.prototype.push.apply(b.games,a.initialGames);b.verifiedUser=a.verifiedUser;
b.tags=a.topTags;t=a.count});b.requestGames=function(a){c||b.allGamesAreDisplayed()||(c=!0,a=u.getGames+"?from="+b.games.length+"&amount="+a+"&d="+Math.floor(Date.now()/36E5),0<e.pass.length&&(a+="&pass="+e.pass),q.get(a,1400).then(function(a){Array.prototype.push.apply(b.games,a.data);c=!1})["catch"](function(a,b){console.log(a,b);c=!1}))};b.rate=function(a,b){};b.like=function(a){b.rate(a,"like",1)};b.dislike=function(a){b.rate(a,"dislike",-1)};b.ifDisabled=function(){return b.disabled};b.css="";
b.mlcLoaded=!1;b.lazyModulesLoaded=!1;d.$on("$routeChangeSuccess",function(a){try{h.ga("send","pageview",{page:k.url()})}catch(r){}});q.get("min/lazy-js.min.js",2E3).then(function(a){eval(a);b.lazyModulesLoaded=!0});/bot|curl|spider|google|twitter^$/i.test(navigator.userAgent)||q.get("src/js/scripts/analytics.js",0).then(function(a){eval(a)});q.get("src/js/objects/"+b.lang+"-text.json").then(function(a){b.textData=a})["catch"](function(a,b){console.log(a,b);confirm("Unable to load textdata, do you want to reload the page?")?
location.reload(!0):null})}]);app.controller("categoryCtrl",["$http","$routeParams","$scope","urls","initialJSON","$lhttp",function(l,h,d,m,f,k){var a=this,p=!1;a.tag=h.category;a.amount=1;a.noGames=!1;d.master.loc="Thorin-Games \u2014 "+a.tag;a.description={en:"Here you can find all our games with the tag "+a.tag+" sorted by popularity",no:'Her kan du finne alle v\u00e5re spill med taggen "'+a.tag+'" sortert etter popularitet',es:'Aqui se encuentra todos nuestros juegos con la etiqueta "'+a.tag+'" Ordenado por popularidad'};
d.master.desc=a.description[d.master.lang];a.games=a.tag in d.master.categories?a.games=d.master.categories[a.tag]:[];k.get(m.countGames+"?tag="+a.tag+"&d="+Date.now()+"&pass="+f.pass,800).then(function(g){a.amount=Number(g);var e=d.master.desc,f=" "+d.master.textData.games;d.master.desc=e.substring(0,e.indexOf(f))+" "+g+e.substring(e.indexOf(f));18<a.amount?a.requestGames(18):a.requestGames(a.amount);0==a.amount&&(a.noGames=!0)});a.requestGames=function(g){if(!p&&!a.allGamesAreDisplayed()){p=
!0;var e=a.games.length;e+g>a.amount&&(g=a.amount-(e+g));g=m.getGames+"?from="+e+"&amount="+g+"&tag="+a.tag+"&d="+Date.now()+"&pass="+f.pass;k.get(g,1500).then(function(e){Array.prototype.push.apply(a.games,e.data);p=!1;d.master.categories[a.tag]=a.games})}};a.allGamesAreDisplayed=function(){return a.games.length>=a.amount}}]);app.controller("gameCtrl",["$scope","$routeParams","$http","$sce","$interval","$timeout","$q","$window","$rootScope","$location","initialJSON","$lhttp","urls",function(l,h,d,m,f,k,a,p,g,e,q,u,b){function t(){/^[\d.,]+%$/.test(c.gamedata.height)&&q.jquery.then(function(){$("embed").ready(function(){k(function(){$("embed").attr("height",$("embed").width()*(Number(c.gamedata.height.split("%")[0])/100)+1)},1E3)})})}var c=this,n=!1,r=!1,v=0;c.ifDisabled=function(){return r};"https:"==location.protocol&&
(location.protocol="http:");a=b.getGames+"?id="+h.id+"&pass="+q.pass;c.gamedata={};c.showRedirectPrompt=!1;u.get(a,1500).then(function(a){c.gamedata=a;l.master.loc="Thorin-Games \u2014 "+a.title;l.master.desc=a.description;a=m.trustAsResourceUrl(c.gamedata.file);"n"==c.gamedata.height&&(c.gamedata.height=.75*window.innerHeight);"r"==c.gamedata.height||"r"==c.gamedata.width?c.showRedirectPrompt=!0:$("embed").attr("src",a);t();Date.now()});c.rate=function(a,e){n=r=!0;d.get(b.rating+"?action="+e+"&id="+
a).then(function(a){n=r=!1;c.gamedata.likes=a.data})};c.refresh=function(){n=r=!0;d.get(b.getGames+"?id="+h.id+"&pass="+q.pass+"&dt="+Date.now()).success(function(a){c.gamedata.comments=a.comments;Date.now();n=r=!1})};var x=f(function(){if(n||r)8<v&&(c.gamedata.comments=[{com:"Lost contact with server - trying to reconnect",author:"..."}],n=!1),v++;else{n=!0;var a=b.checkIfChanged+"?d="+Math.floor(Date.now()/1E4)+"&id="+h.id+"&coms="+c.gamedata.comments.length,e=Date.now();a=d.get(a);a.then(function(a){n=
!1;v=0;JSON.parse(a.data)&&c.refresh();for(a=0;a<c.gamedata.comments.length;a++)c.gamedata.comments[a].date||(c.gamedata.comments[a].date=1459870175813),c.gamedata.comments[a].date+=(Date.now()-e)/1E3});a["catch"](function(){n=!1})}},2400);l.$on("$destroy",function(){return f.cancel(x)});try{c.author=localStorage.username}catch(w){c.author=""}c.comment="";c.submit_comment=function(){if(!r&&0<c.comment.length&&0<c.author.length){l.commentForm.$setUntouched();try{localStorage.username=c.author}catch(w){}n=
r=!0;d.get(b.comment+"?id="+h.id+"&com="+encodeURIComponent(c.comment)+"&author="+encodeURIComponent(c.author)).then(function(a){n=r=!1;c.comment="";c.refresh()})["catch"](function(){alert("Your message was not submitted.\nPlease try again.");r=n=!1})}else l.commentForm.$setTouched()};c.goBack=function(){l.master.routeChanged?p.history.back(1):e.path("/")};c.scrollDown=function(){$("html, body").animate({scrollTop:$(document).height()},1E3)};c.jquery=function(){var a=$("textarea").outerHeight();$("textarea").keyup(function(){var b=
$("form.com-container>div").height()-24;$("a.glyphicon[type=submit]").css("line-height",b+"px");b=$("textarea").width()*(30/270);b=Math.floor($("textarea").val().length/b)+1;$("textarea").css("height",b*a+"px");l.view.ifMobile||$("html, body").animate({scrollTop:$(document).height()})});$(window).resize(t)};q.jquery.then(c.jquery);c.ifSpace=function(){return 140<window.innerWidth-document.querySelector("embed").clientWidth&&!l.view.ifMobile}}]);app.controller("viewCtrl",function(){this.ifMobile="ontouchstart"in window;this.ifATHd=function(){if(ios)return!standalone&&safari?!1:standalone&&!safari?!0:standalone||safari?!1:!0};this.showHeader=function(){return-1<window.location.href.indexOf("/id/")?!1:!0}});app.directive("paraBack",["$window",function(l){return function(h,d,m){d.css("background-image","url("+m.paraBack+")");d.css("background-attachment","fixed");var f=Infinity,k=new Image;k.src=m.paraBack;k.onload=function(){f=k.height-window.innerHeight;d.css("background-position-x",-(k.width/2-d[0].offsetWidth/2)+"px")};var a=function(){var a=Math.floor(.1*this.pageYOffset);a<f&&d.css("background-position-y","-"+a+"px")};h.view.ifMobile||(angular.element(l).on("scroll",a),h.$on("$destroy",function(){angular.element(l).off("scroll",
a)}))}}]);