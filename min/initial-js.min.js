var app=angular.module("app",["ngRoute"]);
app.config(["$routeProvider","$sceProvider","$locationProvider","$controllerProvider","$provide","$compileProvider","$filterProvider","$sceDelegateProvider",function(f,g,c,p,d,h,a,k){k.resourceUrlWhitelist(["self","https://script.google.com"]);g.enabled(!0);f.when("/",{templateUrl:"src/views/home.html"}).when("/tag/:category",{templateUrl:"src/views/category.html"}).when("/search/:category",{templateUrl:"src/views/category.html"}).when("/id/:id",{controller:"gameCtrl",controllerAs:"g",templateUrl:"src/views/game.html"}).when("/submit",
{templateUrl:"src/views/submit.html"}).when("/cookies",{templateUrl:"src/views/policy.html"}).when("/contact",{templateUrl:"src/views/contact.html"}).when("/tag",{redirectTo:"/"}).otherwise({templateUrl:"src/views/error.html"});c.html5Mode(!0);app.controller=function(a,c){p.register(a,c);return this};app.service=function(a,c){d.service(a,c);return this};app.directive=function(a,c){h.directive(a,c);return this};app.filter=function(c,d){a.register(c,d);return this}}]);
app.service("initialJSON",["$http","$httpx","urls",function(f,g,c){this.pass=encodeURIComponent(window.location.search.slice(1)+window.location.hash.slice(1));this.json=g.get(this.pass.length?"https://script.google.com/macros/s/AKfycbzEVUBnYRqGOFS6309I9Oe748omXUWLjpDScrjYatNvxKuL6BEU/exec?pass="+this.pass:c.initialJSON,{lifetime:36E5});this.jquery=g.get("https://code.jquery.com/jquery-2.2.3.min.js",{lifetime:Infinity});this.jquery.then(function(c){eval(c)})}]);
app.directive("script",function(){return{restrict:"E",scope:!1,link:function(f,g,c){"text/javascript-lazy"===c.type&&eval(g[0].text)}}});
app.value("urls",{rating:"https://script.google.com/macros/s/AKfycbzulzGAeSR2eErndxSAUkDi3dXlnmYif0MlkpjnfJsHKVNSMpE/exec",checkIfChanged:"https://script.google.com/macros/s/AKfycbwx-oLuzjUIAPxMxKiiNFgt6Wgb6T4WGO8UguTGu8HCXUBt-SX7/exec",comment:"https://script.google.com/macros/s/AKfycbwK2mif23UU5f9B2NXuvcRT6VajMU7iXQPxRnlKeNtfsD2Eflvz/exec",countGames:"https://script.google.com/macros/s/AKfycbwc3i7zLH3vC8HWnVtBVPqZkv8iOMIlxKZ1E7gL2bdIL8kd9lA/exec",getGames:"https://script.google.com/macros/s/AKfycbxGh5agyHkqBi5KbpYxl9G2gJlR5kuJzjJ--5BaP-KfcgaItx0/exec",
submitGame:"https://script.google.com/macros/s/AKfycbxh_WPU_DKwT3xAxR0BCcjb_wQ4pQG2nspBbpKra94BEYlO4yw/exec",subscribe:"",initialJSON:"/min/initialJSON.json"});app.controller("masterCtrl",["$http","$window","$rootScope","$routeParams","$scope","$location","$timeout","$injector","$sce","$q","initialJSON","$httpx","urls",function(f,g,c,p,d,h,a,k,e,l,q,r,t){var b=this;b.request_in_progress=!1;b.query="";b.lang=window.navigator.language.replace(/-.+/g,"");b.availableLangs=["en","es","no"];b.desc="";b.games={"/":[]};b.routeChanged=!1;b.verifiedUser=!1;b.tags=[{name:"Puzzle",amount:470},{name:"Action",amount:334},{name:"Jigsaw Puzzles",amount:315},{name:"Shooting",
amount:256},{name:"HTML5",amount:210},{name:"Racing",amount:202},{name:"Adventure",amount:196}];b.textData={};b.showAllTags=!1;b.ifMobile="ontouchstart"in window;b.mobileGamesOnly=b.ifMobile;b.showHeader=function(){return!window.location.href.includes("/id/")};window.location.href.includes("lang=")&&(b.lang=window.location.href.replace(/.+lang=/,""));b.lang="nb"==b.lang||"nn"==b.lang?"no":b.lang;b.lang=-1<b.availableLangs.indexOf(b.lang)?b.lang:"en";q.json.then(function(a){Array.prototype.push.apply(b.games["/"],
a.initialGames);b.verifiedUser=a.verifiedUser;b.tags=a.topTags});b.rate=function(b,a){};b.like=function(a){b.rate(a,"like",1)};b.dislike=function(a){b.rate(a,"dislike",-1)};b.ifDisabled=function(){return b.request_in_progress};b.css="";b.mlcLoaded=!1;b.lazyModulesLoaded=!1;c.$on("$routeChangeSuccess",function(b){try{g.ga("send","pageview",{page:h.url()})}catch(n){}});r.get("min/lazy-js.min.js",{lifetime:36E5}).then(function(a){eval(a);b.lazyModulesLoaded=!0});/bot|curl|spider|google|twitter^$/i.test(navigator.userAgent)||
r.get("src/js/scripts/analytics.js",{lifetime:Infinity}).then(function(b){eval(b)});r.get("src/js/objects/"+b.lang+"-text.json").then(function(a){b.textData=a;b.textData.flashPrompt=e.trustAsHtml(b.textData.flashPrompt)})["catch"](function(b,a){console.log(b,a);confirm("Unable to load textdata, do you want to reload the page?")?location.reload(!0):null})}]);app.controller("categoryCtrl",["$http","$routeParams","$scope","urls","initialJSON","$httpx",function(f,g,c,p,d,h){var a=this,k=!1;a.tag=g.category||"/";a.max_amount=1;a.noGames=!1;c.master.loc="Texiplay \u2014 "+("/"!==a.tag?a.tag:c.master.textData.title);c.master.desc="/"!==a.tag?c.master.textData.categoryDescription.replace("{{tag}}",a.tag):c.master.textData.intro;a.games=a.tag in c.master.games?a.games=c.master.games[a.tag]:[];h.get(p.countGames+"?d="+Date.now()+("/"!==a.tag?"&tag="+a.tag:"")+
"&pass="+d.pass).then(function(d){a.max_amount=Number(d);var e=c.master.desc;if("/"!==a.tag){var f=" "+c.master.textData.games;c.master.desc=e.substring(0,e.indexOf(f))+" "+d+e.substring(e.indexOf(f))}18<a.max_amount?a.requestGames(18):a.requestGames(a.max_amount);0==a.max_amount&&(a.noGames=!0)});a.requestGames=function(e){if(!k&&!a.allGamesAreDisplayed()){k=!0;var f=a.games.length;f+e>a.max_amount&&(e=a.max_amount-(f+e));e=p.getGames+"?from="+f+"&amount="+e+("/"!==a.tag?"&tag="+a.tag:"")+"&d="+
Date.now()+"&pass="+d.pass;h.get(e,{lifetime:18E5}).then(function(d){Array.prototype.push.apply(a.games,d.data);k=!1;c.master.games[a.tag]=a.games})}};a.allGamesAreDisplayed=function(){return a.games.length>=a.max_amount}}]);app.controller("gameCtrl",["$scope","$routeParams","$http","$sce","$interval","$timeout","$window","$location","initialJSON","$httpx","urls",function(f,g,c,p,d,h,a,k,e,l,q){function r(){/^[\d.,]+%$/.test(b.gamedata.height)&&e.jquery.then(function(){$("embed").ready(function(){h($("embed").attr,1E3,!0,"height",$("embed").width()*(Number(b.gamedata.height.split("%")[0])/100)+1)})})}function t(){m=n=!0;c.get(q.getGames+"?id="+g.id+"&pass="+e.pass+"&dt="+Date.now()).success(function(a){b.gamedata.comments=
a.comments;m=n=!1})}var b=this,m=!1,n=!1,u=0;"https:"===location.protocol&&(location.protocol="http:");b.gamedata={};b.showRedirectPrompt=!1;b.showFlashPrompt=!1;b.loading=!0;l.get(q.getGames+"?id="+g.id+"&pass="+e.pass,{lifetime:36E5}).then(function(a){b.gamedata=a;b.loading=!1;f.master.loc="Texiplay \u2014 "+a.title;f.master.desc=a.description;a=p.trustAsResourceUrl(b.gamedata.file);var c=!1;try{c=!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(x){c="undefined"!=typeof navigator.mimeTypes["application/x-shockwave-flash"]}"n"===
b.gamedata.height&&(b.gamedata.height=.75*window.innerHeight);"r"===b.gamedata.height||"r"===b.gamedata.width?b.showRedirectPrompt=!0:c||!b.gamedata.file.match(/\.swf$/)?$("embed").attr("src",a):b.showFlashPrompt=!0;r()});b.rate=function(a,d){m=n=!0;c.get(q.rating+"?action="+d+"&id="+a).then(function(a){m=n=!1;b.gamedata.likes=a.data.data})};b.ifDisabled=function(){return n};try{b.author=localStorage.username}catch(v){b.author=""}b.comment="";b.submit_comment=function(){if(!n&&0<b.comment.length&&
0<b.author.length){f.commentForm.$setUntouched();try{localStorage.username=b.author}catch(v){}m=n=!0;c.get(q.comment+"?id="+g.id+"&com="+encodeURIComponent(b.comment)+"&author="+encodeURIComponent(b.author)).then(function(a){m=n=!1;b.comment="";t()})["catch"](function(){alert("Your message was not submitted.\nPlease try again.");n=m=!1})}else f.commentForm.$setTouched()};b.goBack=function(){return f.master.routeChanged?a.history.back(1):k.path("/")};b.jquery=function(){var b=$("textarea").outerHeight();
$("textarea").keyup(function(){$("a.glyphicon[type=submit]").css("line-height",$(".comments>form>div").height()-24+"px");var a=$("textarea").width()*(30/270);a=Math.floor($("textarea").val().length/a)+1;$("textarea").css("height",a*b+"px");f.master.ifMobile||$("html, body").animate({scrollTop:$(document).height()})});$(window).resize(r)};e.jquery.then(b.jquery);var w=d(function(){if(m||n)8<u&&(b.gamedata.comments=[{com:"Lost contact with server - trying to reconnect",author:"..."}],m=!1),u++;else{m=
!0;var a=q.checkIfChanged+"?d="+Math.floor(Date.now()/1E4)+"&id="+g.id+"&coms="+b.gamedata.comments.length,d=Date.now();c.get(a).then(function(a){m=!1;u=0;JSON.parse(a.data)&&t();for(a=0;a<b.gamedata.comments.length;a++)b.gamedata.comments[a].date||(b.gamedata.comments[a].date=1459870175813),b.gamedata.comments[a].date+=(Date.now()-d)/1E3})["catch"](function(){m=!1})}},2400);f.$on("$destroy",function(){return d.cancel(w)});b.ifSpace=function(){return 140<window.innerWidth-document.querySelector("embed").clientWidth&&
!f.master.ifMobile}}]);app.directive("paraBack",["$window",function(f){return function(g,c,p){c.css("background-image","url("+p.paraBack+")");c.css("background-attachment","fixed");var d=Infinity,h=new Image;h.src=p.paraBack;h.onload=function(){d=h.height-window.innerHeight;c.css("background-position-x",-(h.width/2-c[0].offsetWidth/2)+"px")};var a=function(){var a=Math.floor(.1*this.pageYOffset);a<d&&c.css("background-position-y","-"+a+"px")};g.master.ifMobile||(angular.element(f).on("scroll",a),g.$on("$destroy",function(){angular.element(f).off("scroll",
a)}))}}]);app.service("$httpx",["$http","$q",function(f,g){var c=angular.extend({},f);c.get=function(c,d){var h=!1,a=0,k=g.defer();"undefined"===typeof d&&(d={});"lifetime"in d||(d.lifetime=0);"string"===typeof d.alt_urls&&(d.alt_urls=[d.alt_urls]);var e="undefined"===typeof d.alt_urls?[c]:d.alt_urls.push(c)&&d.alt_urls,l=d.timeout;"number"===typeof l?$timeout(function(){return k.reject("TIMED OUT")},l):"undefined"!==typeof l&&l["catch"](function(){return k.reject("CANCELLED")});d.timeout=k.promise;if("undefined"!==
typeof Storage&&e[0]in localStorage&&Number(localStorage[e[0]+"_expiry"])>Date.now())k.resolve(JSON.parse(localStorage[e[0]])),h=!0;else for(l=0;l<e.length;l++)d.withCredentials=e[l].includes("bris-cdn.cf"),f.get(e[l],d).then(function(a){h||k.resolve(a.data);h=!0;"undefined"!==typeof Storage&&(localStorage[e[0]]=JSON.stringify(a.data),localStorage[e[0]+"_expiry"]=Number(d.lifetime)+Date.now())}).then(function(c){a++;h||a!==e.length||("undefined"!==typeof Storage&&e[0]in localStorage?(k.resolve(localStorage[e[0]]),
h=!0):k.reject("ERROR"))});return k.promise};return c}]);